<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <!-- Ajuste o meta viewport para suportar 'viewport-fit=cover' e evitar zoom -->
  <meta name="viewport" 
        content="width=device-width, initial-scale=1.0,
                 maximum-scale=1.0, user-scalable=no,
                 viewport-fit=cover">
  <title>Jogo 2D</title>
  <!-- Fonte Poppins -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

  <style>
    /* ------------------ VARIÁVEL CSS PARA ALTURA REAL ------------------ */
    :root {
      --vh: 100%; /* Valor inicial de fallback */
    }

    /* Reset e configuração global */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      user-select: none;
    }

    /* 
      html e body ocupam a tela inteira usando a variável --vh,
      evitando scroll em dispositivos móveis quando a barra some/aparece.
    */
    html, body {
      width: 100vw;
      height: calc(var(--vh) * 100);
      overflow: hidden;
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(to right, #ff99cc, #ff66b2);
    }

    /* Responsividade para dispositivos móveis em horizontal */
    @media only screen and (max-width: 768px) and (orientation: landscape) {
      .sidebar { width: 250px; padding: 15px; }
      .menu button { font-size: 20px; padding: 12px; }
      .content { font-size: 24px; }
      .dialog-box { max-width: 400px; padding: 12px; font-size: 16px; }
      .dialog-buttons button { font-size: 14px; padding: 4px 8px; }
      .language-selector img { width: 28px; height: 28px; }
    }

    /* --------------------- SIDEBAR (Menu Principal) -------------------- */
    .sidebar {
      position: fixed;
      top: 0;
      left: 0;
      width: 300px;
      /* Substituir 100vh por calc(var(--vh) * 100) */
      height: calc(var(--vh) * 100);
      background: rgba(255,105,180,0.9);
      border-right: 4px solid white;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      z-index: 3;
      transition: opacity 0.5s ease;
    }
    .logo {
      text-align: center;
      margin-bottom: 30px;
    }
    .logo img {
      max-width: 150px;
      margin-bottom: 10px;
    }
    .logo span {
      font-size: 36px;
      font-weight: 600;
      text-transform: uppercase;
    }
    .menu {
      width: 100%;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    .menu button {
      width: 100%;
      padding: 15px;
      font-size: 22px;
      font-weight: 600;
      color: white;
      background: #ff66b2;
      border: 2px solid white;
      border-radius: 15px;
      text-align: left;
      cursor: pointer;
      transition: background 0.3s, color 0.3s;
    }
    .menu button:hover {
      background: white;
      color: #ff66b2;
      border-color: #ff66b2;
    }

    /* Seletor de idioma – ícones modernos */
    .language-selector {
      margin-top: auto;
      display: flex;
      gap: 10px;
    }
    .language-selector img {
      width: 32px;
      height: 32px;
      cursor: pointer;
      border: 2px solid transparent;
      border-radius: 50%;
      transition: transform 0.3s, box-shadow 0.3s, border-color 0.3s;
    }
    .language-selector img:hover {
      transform: scale(1.1);
      box-shadow: 0 2px 10px rgba(0,0,0,0.3);
      border-color: #3498db;
    }
    .language-selector img.active {
      border-color: #3498db;
      transform: scale(1.1);
    }

    /* Música Tema (oculta controles) */
    audio {
      display: none;
    }

    /* ---------------- FULL-SCREEN CONTENT (Config, Loja, Sair) --------- */
    .full-screen-content {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      /* Substituir 100vh por calc(var(--vh) * 100) */
      height: calc(var(--vh) * 100);
      background: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 4;
      transition: opacity 0.5s ease;
    }
    .full-screen-content.hidden {
      opacity: 0;
      pointer-events: none;
    }
    .full-screen-content h2 {
      margin-bottom: 20px;
    }
    .full-screen-content p {
      margin-bottom: 20px;
      font-size: 20px;
    }
    .full-screen-content button {
      padding: 10px 20px;
      font-size: 18px;
      border: none;
      border-radius: 8px;
      background: #ff66b2;
      color: white;
      cursor: pointer;
      transition: background 0.3s;
    }
    .full-screen-content button:hover {
      background: #ff99cc;
    }

    /* ------------------ GLOBAL LOADING SCREEN --------------------------- */
    .global-loading {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      /* Substituir 100vh por calc(var(--vh) * 100) */
      height: calc(var(--vh) * 100);
      background: #fce4ec;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 10000;
      transition: opacity 0.5s ease;
    }
    .global-loading.hidden {
      opacity: 0;
      pointer-events: none;
    }
    .global-loading .loading-content {
      text-align: center;
      color: #ff66b2;
      animation: slideUp 0.8s ease-out;
      width: 100%;
    }
    .global-loading .loading-logo {
      max-width: 200px;
      margin-bottom: 20px;
    }
    .global-loading .loading-text {
      font-size: 20px;
      margin-bottom: 20px;
    }
    .global-loading .spinner {
      border: 6px solid rgba(255,102,178,0.3);
      border-top: 6px solid #ff66b2;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin: 20px auto;
    }
    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    @keyframes slideUp {
      from { transform: translateY(20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    /* ----------------- ACTION LOADING SCREEN --------------------------- */
    .action-loading {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      /* Substituir 100vh por calc(var(--vh) * 100) */
      height: calc(var(--vh) * 100);
      background: #fce4ec;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 11000;
      transition: opacity 0.5s ease;
    }
    .action-loading.hidden {
      opacity: 0;
      pointer-events: none;
    }
    .action-loading .loading-content {
      text-align: center;
      color: #ff66b2;
    }

    /* ------------------ MODAL DE CONFIRMAÇÃO --------------------------- */
    .confirm-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      /* Substituir 100vh por calc(var(--vh) * 100) */
      height: calc(var(--vh) * 100);
      background: rgba(0,0,0,0.7);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 12000;
      transition: opacity 0.3s;
    }
    .confirm-modal.show {
      opacity: 1;
    }
    .confirm-modal.hidden {
      display: none;
    }
    .confirm-modal-content {
      background: #fff;
      color: #333;
      padding: 20px 30px;
      border-radius: 10px;
      text-align: center;
      max-width: 400px;
      animation: scaleIn 0.5s ease-out;
    }
    .confirm-modal-content .confirm-text {
      font-size: 18px;
      margin-bottom: 20px;
    }
    .confirm-modal-content .confirm-buttons {
      display: flex;
      gap: 20px;
      justify-content: center;
    }
    .confirm-modal-content button {
      padding: 8px 15px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
    }
    .confirm-modal-content button:first-child {
      background: #ff66b2;
      color: white;
    }
    .confirm-modal-content button:last-child {
      background: #ccc;
      color: #333;
    }
    @keyframes scaleIn {
      from { transform: scale(0.8); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }

    /* ------------------ POPUP DE TRADUÇÃO ----------------------------- */
    .translate-popup {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(255,255,255,0.95);
      color: #333;
      padding: 10px 20px;
      border-radius: 5px;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
      z-index: 12000;
      transition: opacity 0.5s;
      opacity: 0;
    }
    .translate-popup.show {
      opacity: 1;
    }

    /* --------------------- MODO DE JOGO ------------------------------- */
    .game-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      /* Substituir 100vh por calc(var(--vh) * 100) */
      height: calc(var(--vh) * 100);
      background: black;
      overflow: hidden;
      z-index: 5;
      display: none;
    }
    .game-container img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      cursor: pointer;
    }

    /* --------------------- CAIXA DE DIÁLOGO --------------------------- */
    .dialog-box {
      position: absolute;
      bottom: 30%;
      left: 50%;
      transform: translateX(-50%);
      width: 90%;
      max-width: 500px;
      padding: 15px;
      font-size: 18px;
      font-weight: 600;
      border-radius: 10px;
      text-align: left;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
      background: #e0e0e0;
      color: #333;
      border: 1px solid #999;
      position: relative;
      overflow: hidden;
      transition: all 0.3s;
    }
    /* Tema Masculino – Caixa de Diálogo do Player */
    .dialog-box.masculine {
      background: #e0e0e0;
      color: #333;
      border: 2px solid #3498db;
      border-radius: 15px;
      box-shadow: 0 8px 16px rgba(0,0,0,0.3);
      padding: 20px;
    }
    /* Tema Feminino – Personagem */
    .dialog-box.feminine {
      background: #ffe6f0;
      color: black;
      border: 2px solid #ff66b2;
      background-image: url('https://i.imgur.com/6D2L5vO.png');
      background-repeat: no-repeat;
      background-position: top right;
      background-size: 80px;
    }
    .dialog-box .speaker {
      font-size: 20px;
      margin-bottom: 8px;
    }
    /* Botões abaixo da Caixa de Diálogo */
    .dialog-buttons {
      position: absolute;
      bottom: 5%;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 15px;
    }
    .dialog-buttons button {
      background: rgba(0, 0, 0, 0.5);
      border: none;
      padding: 8px 12px;
      font-size: 14px;
      color: #fff;
      border-radius: 5px;
      cursor: pointer;
      transition: background 0.3s;
    }
    .dialog-buttons button:hover {
      background: rgba(0, 0, 0, 0.7);
    }

    /* Container para Escolhas */
    .choice-container {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      bottom: 35%;
      display: flex;
      flex-direction: column;
      gap: 10px;
      opacity: 0;
      transition: opacity 0.5s;
    }
    .choice-container.show {
      opacity: 1;
    }
    .choice-container button {
      background: #ff66b2;
      border: 2px solid white;
      padding: 10px;
      font-size: 18px;
      border-radius: 10px;
      cursor: pointer;
      color: white;
      font-weight: 600;
    }
    .choice-container button:hover {
      background: white;
      color: #ff66b2;
    }
  </style>
</head>
<body>
  <!-- Música Tema -->
  <audio id="theme-music" src="theme-music.mp3" autoplay loop></audio>

  <!-- Menu Principal (Sidebar) -->
  <div class="sidebar" id="sidebar">
    <div class="logo">
      <img src="https://via.placeholder.com/150?text=Logo" alt="Logo">
      <span>MEU JOGO</span>
    </div>
    <div class="menu">
      <button onclick="confirmStart()">Começar</button>
      <button onclick="loadGame()">Carregar</button>
      <button onclick="showContent('settings')">Configurações</button>
      <button onclick="showContent('store')">Loja</button>
      <button onclick="showContent('exit')">Sair</button>
    </div>
    <div class="language-selector">
      <img src="https://flagcdn.com/48x36/br.png" alt="Português" onclick="translateContent('pt')">
      <img src="https://flagcdn.com/48x36/us.png" alt="English" onclick="translateContent('en')">
    </div>
  </div>

  <!-- Telas de Conteúdo Full-Screen -->
  <div id="content-settings" class="content full-screen-content hidden">
    <h2>Configurações</h2>
    <p>Aqui você pode ajustar as configurações do jogo.</p>
    <button onclick="backToMenu()">Voltar</button>
  </div>

  <div id="content-store" class="content full-screen-content hidden">
    <h2>Loja</h2>
    <p>Aqui você pode comprar itens e upgrades.</p>
    <button onclick="backToMenu()">Voltar</button>
  </div>

  <div id="content-exit" class="content full-screen-content hidden">
    <h2>Sair</h2>
    <p>Você optou por sair do jogo.</p>
    <button onclick="backToMenu()">Voltar</button>
  </div>

  <!-- Tela de Carregamento Global -->
  <div id="global-loading" class="global-loading">
    <div class="loading-content">
      <img src="https://via.placeholder.com/150?text=Logo" alt="Logo" class="loading-logo">
      <div class="loading-text">Este é um jogo para maiores de 18 anos. Por favor, aguarde...</div>
      <div class="spinner"></div>
    </div>
  </div>

  <!-- Tela de Carregamento de Ação -->
  <div id="action-loading" class="action-loading hidden">
    <div class="loading-content">
      <div class="loading-text">Carregando...</div>
      <div class="spinner"></div>
    </div>
  </div>

  <!-- Modal de Confirmação -->
  <div id="confirm-modal" class="confirm-modal hidden">
    <div class="confirm-modal-content">
      <div class="confirm-text">Você já possui um jogo salvo. Tem certeza de que deseja iniciar um novo jogo?</div>
      <div class="confirm-buttons">
        <button onclick="startNewGame()">Sim, iniciar novo jogo</button>
        <button onclick="hideConfirmModal()">Cancelar</button>
      </div>
    </div>
  </div>

  <!-- Popup de Tradução -->
  <div id="translate-popup" class="translate-popup hidden">
    <!-- Espaço para inserir futuramente as traduções -->
  </div>

  <!-- Modo de Jogo -->
  <div id="game" class="game-container">
    <img id="game-image" src="" onclick="nextScene()" draggable="false">
    <div id="game-dialog" class="dialog-box neutral"></div>
    <div class="dialog-buttons">
      <button onclick="prevScene()">Voltar</button>
      <button onclick="pular()">Pular</button>
      <button onclick="avancarRapido()">Avançar</button>
      <button onclick="autoPlay()">Auto</button>
      <button onclick="exitGame()">Menu</button>
    </div>
    <div id="choices" class="choice-container"></div>
  </div>

  <script>
    /*
      ATUALIZA A VARIÁVEL --vh SEMPRE QUE A TELA É REDIMENSIONADA
      OU QUANDO A ORIENTAÇÃO MUDA (portrait <-> landscape).
      Isso corrige problemas de "100vh" em mobile.
    */
    function setRealViewportHeight() {
      const vh = window.innerHeight * 0.01;
      document.documentElement.style.setProperty('--vh', `${vh}px`);
    }
    window.addEventListener('load', setRealViewportHeight);
    window.addEventListener('resize', setRealViewportHeight);
    window.addEventListener('orientationchange', setRealViewportHeight);

    /* ---------------------------------------------------------
       SEU SCRIPT PRINCIPAL (CENAS, FUNÇÕES DE JOGO, ETC.)
       --------------------------------------------------------- */

    let currentScene = 0;
    let autoMode = false;
    let autoInterval;
    let currentLang = "pt"; // idioma atual
    let globalLoadingTimeout;

    // Função para exibir o conteúdo full-screen e ocultar o menu principal
    function showContent(contentName) {
      document.getElementById("sidebar").style.display = "none";
      document.querySelectorAll(".full-screen-content").forEach(content => {
        content.classList.add("hidden");
      });
      const selectedContent = document.getElementById("content-" + contentName);
      if (selectedContent) {
        selectedContent.classList.remove("hidden");
      }
    }

    // Função para voltar ao menu principal
    function backToMenu() {
      document.querySelectorAll(".full-screen-content").forEach(content => {
        content.classList.add("hidden");
      });
      document.getElementById("sidebar").style.display = "flex";
    }

    /* Dicionário para Traduções para as Cenas */
    const translations = {
      0: { pt: "Você acorda em um quarto estranho. Não lembra como chegou aqui." },
      1: { pt: "Você vê uma porta entreaberta e uma janela com vista para um jardim iluminado pelo sol." },
      2: { pt: "Você se levanta, sentindo uma mistura de medo e curiosidade." },
      3: { pt: "Ao sair do quarto, um corredor silencioso se estende à sua frente." },
      4: { pt: "Você encontra um bilhete enigmático na parede: 'Escolha seu destino'" },
      5: { pt: "O bilhete te desafia: o que você fará agora?" },
      6: { pt: "Você segue pelo corredor e descobre uma escada que desce para o porão." },
      7: { pt: "Decidindo voltar, você percebe que o quarto agora parece diferente, cheio de segredos." },
      8: { pt: "No porão, objetos antigos e um mapa misterioso chamam sua atenção." },
      9: { pt: "Seguindo o mapa, você se dirige a um suposto tesouro escondido." },
      10: { pt: "A jornada se intensifica à medida que você se aproxima do destino." },
      11: { pt: "Você entra em uma sala repleta de segredos do passado." },
      12: { pt: "A aventura chega a um ponto crítico. O que você fará agora?" },
      13: { pt: "Você encontra uma pista que pode mudar tudo." },
      14: { pt: "Você decide que é hora de recomeçar. Fim da demonstração." },
      15: { pt: "A personagem diz: 'Bem-vindo ao mundo de aventuras!'" }
    };

    /* Dicionário para Traduções das Escolhas */
    const choiceTranslations = {
      5: [
        { pt: "Investigar o corredor" },
        { pt: "Voltar para o quarto" }
      ],
      12: [
        { pt: "Investigar a sala" },
        { pt: "Retornar à entrada" }
      ]
    };

    // Define as cenas
    const scenes = [
      { img: "https://raw.githubusercontent.com/natrona/nekoserver/refs/heads/main/download%20(15).jpeg", speaker: null, choice: null },
      { img: "https://via.placeholder.com/1920x1080/FF99CC/FFFFFF?text=Cena+2", speaker: null, choice: null },
      { img: "https://via.placeholder.com/1920x1080/FFB6C1/FFFFFF?text=Cena+3", speaker: "player", choice: null },
      { img: "https://via.placeholder.com/1920x1080/FFD1DC/FFFFFF?text=Cena+4", speaker: null, choice: null },
      { img: "https://via.placeholder.com/1920x1080/FFC0CB/FFFFFF?text=Cena+5", speaker: null, choice: null },
      {
        img: "https://via.placeholder.com/1920x1080/FF69B4/FFFFFF?text=Cena+6",
        speaker: null,
        choice: [
          { next: 6 },
          { next: 7 }
        ]
      },
      { img: "https://via.placeholder.com/1920x1080/FF1493/FFFFFF?text=Cena+7", speaker: "player", choice: null },
      { img: "https://via.placeholder.com/1920x1080/DB7093/FFFFFF?text=Cena+8", speaker: "player", choice: null },
      { img: "https://via.placeholder.com/1920x1080/FF69B4/FFFFFF?text=Cena+9", speaker: null, choice: null },
      { img: "https://via.placeholder.com/1920x1080/FF6EB4/FFFFFF?text=Cena+10", speaker: "player", choice: null },
      { img: "https://via.placeholder.com/1920x1080/FF82AB/FFFFFF?text=Cena+11", speaker: null, choice: null },
      { img: "https://via.placeholder.com/1920x1080/FFB6C1/FFFFFF?text=Cena+12", speaker: null, choice: null },
      {
        img: "https://via.placeholder.com/1920x1080/FFC0CB/FFFFFF?text=Cena+13",
        speaker: "character",
        choice: [
          { next: 13 },
          { next: 14 }
        ]
      },
      { img: "https://via.placeholder.com/1920x1080/FF69B4/FFFFFF?text=Cena+14", speaker: "character", choice: null },
      { img: "https://via.placeholder.com/1
